skyforge:
  hostname: skyforge.local.forwardnetworks.com
  domain: forwardnetworks.com
  publicUrl: https://skyforge.local.forwardnetworks.com

  # Comma-separated usernames/emails that should see admin-only UI + APIs.
  # NOTE: Server-side admin checks are exact-match (no wildcards).
  adminUsers: "skyforge,craigjohnson,craigjohnson@forwardnetworks.com"

  encoreCfg:
    # Manage the API service typed config secret via Helm so feature flags and
    # defaults (Gemini/Elastic/etc.) reliably propagate into the running pods.
    create: true
    # Ensure the worker service gets the same Helm-driven typed config as the API.
    # Without this, the worker falls back to whatever was baked into its image.
    workerCreate: true
    # Speed up queued-task pickup when Pub/Sub delivery is delayed.
    # This tunes only worker-side fallback polling behavior.
    workerJson: |
      {
        "TaskWorkerPollEnabled": true,
        "TaskWorkerPollMinQueuedSeconds": 20,
        "TaskWorkerPollMaxTasksPerTick": 20,
        "TaskWorkerPollMaxConcurrency": 8
      }

  # Provide ENCORE_RUNTIME_CONFIG from the chart's `files/infra.config.json`.
  # This keeps Skyforge server images portable (no baked-in infra config).
  encoreRuntimeConfig:
    # Deprecated: prefer `ENCORE_INFRA_CONFIG_PATH` which points at the mounted
    # `infra.config.json` ConfigMap. Leave these disabled to avoid version skew
    # and base64 encoding pitfalls across Encore runtime versions.
    create: false
    workerCreate: false

  # Run a dedicated worker Deployment to process NSQ tasks and internal reconciles.
  # Keep this separate from the API Deployment to avoid "queued" runs caused by
  # non-worker pods grabbing subscriptions.
  workerReplicaCount: 2

  netbox:
    enabled: true
  netboxUrl: https://skyforge.local.forwardnetworks.com/netbox
  netboxSsoUrl: https://skyforge.local.forwardnetworks.com/netbox

  nautobot:
    enabled: true
  nautobotUrl: https://skyforge.local.forwardnetworks.com/nautobot
  nautobotSsoUrl: https://skyforge.local.forwardnetworks.com/nautobot

  elastic:
    enabled: true
    indexingMode: per_user
    autosleep:
      enabled: true
      idleMinutes: 30
    kibanaSubpath: /kibana
    elasticsearch:
      storage:
        enabled: true
        storageClassName: longhorn

  coder:
    hostAliases:
      - ip: "10.128.16.60"
        hostnames:
          - "skyforge.local.forwardnetworks.com"

  # Forward on-prem "app cluster" UI proxied under Skyforge SSO.
  forwardApp:
    enabled: true
    pathPrefix: /fwd
    rootAliases:
      enabled: true
      paths:
        - /login
        - /logout
    cookiePathMode: alias
    upstreamNamespace: forward
    upstreamService: fwd-appserver
    upstreamPort: 8443
    upstreamTLS: true
    requireAuth: false
    autosleep:
      enabled: false
      idleMinutes: 30
      wakeTimeoutSeconds: 240

  # In-cluster Forward collector deployed per user by Skyforge. This must be set,
  # otherwise collector configs can be created in Forward but no Pod will be deployed
  # (Collector UI shows "not configured" and collectors never connect).
  forwardCollector:
    image: "ghcr.io/forwardnetworks/skyforge-forward-collector:26.1.0-11"
    heapSizeGB: 16

  # Swagger image pulls can be rate-limited on Docker Hub; keep this disabled
  # in production unless you pin a mirrored image.
  swaggerUI:
    enabled: false

  # Keep registry integration enabled for GHCR-backed workflows.
  registry:
    url: https://ghcr.io

  # Enable Gitea provisioning for blueprint-backed workflows and E2E tests.
  # API URL is in-cluster; UI URL is the SSO-proxied external path.
  gitea:
    apiUrl: http://gitea:3000/api/v1
    url: https://skyforge.local.forwardnetworks.com/gitea

  # Enable the AI template generator UI + APIs.
  ai:
    enabled: true

  # Enable per-user "Connect Gemini" and Gemini-backed template generation.
  # NOTE: `clientID` and `projectId` must be set for full functionality.
  gemini:
    enabled: true
    clientID: ""
    projectId: ""

  # Pin netlab-c9s generator image so `netlab initial` has the artifacts it needs.
  netlabC9s:
    generatorImage: "ghcr.io/forwardnetworks/skyforge-netlab-generator:20260214-native-docs1"
    applierImage: "ghcr.io/forwardnetworks/skyforge-netlab-applier:20260206-b6a1937"
    defaultEnvironment:
      SKYFORGE_CLABERNETES_TOLERATE_CONTROL_PLANE: "false"
      SKYFORGE_CLABERNETES_SCHEDULING_MODE: "adaptive"
      SKYFORGE_CLABERNETES_ADAPTIVE_PACK_MAX_NODES: "3"
      SKYFORGE_CLABERNETES_HEAVY_NOS_SPREAD_OVERRIDE: "true"
      SKYFORGE_CLABERNETES_POD_ANTI_AFFINITY_REQUIRED: "false"
      SKYFORGE_FORWARD_CONNECTIVITY_EARLY: "true"
      SKYFORGE_FORWARD_CONNECTIVITY_EARLY_SECONDS: "300"
      SKYFORGE_FORWARD_CONNECTIVITY_EARLY_CONCURRENCY: "16"
      SKYFORGE_FORWARD_CONNECTIVITY_EARLY_BATCH: "12"
      SKYFORGE_NETLAB_INITIAL_SSH_READY_SECONDS: "900"
      SKYFORGE_FORWARD_SSH_READY_SECONDS: "900"

  housekeeping:
    enabled: true
    schedule: "*/15 * * * *"
    jobRetentionHours: 1
    e2eNamespacePrefix: "ws-e2e-"
    e2eNamespaceRetentionHours: 12

  admissionPolicies:
    enabled: true

  imagePrewarm:
    enabled: true
    intervalSeconds: 1800
    registryAuth:
      usernameSecretName: "skyforge-registry-username"
      usernameSecretKey: "skyforge-registry-username"
      passwordSecretName: "skyforge-registry-password"
      passwordSecretKey: "skyforge-registry-password"
    images:
      - "ghcr.io/forwardnetworks/vrnetlab/vr-n9kv:9.3.8-skyforge1"
      - "ghcr.io/forwardnetworks/vrnetlab/extreme_exos:33.1.1.31"
      - "ghcr.io/forwardnetworks/vrnetlab/vr-vmx:18.2R1.9"
      - "ghcr.io/forwardnetworks/vrnetlab/juniper_vjunosevolved:25.2R1.8-EVO"
      - "ghcr.io/forwardnetworks/vrnetlab/cisco_c8000v:17.16.01a"
      - "ghcr.io/forwardnetworks/ceos:4.34.2F"
      - "ghcr.io/forwardnetworks/skyforge-linux-host:20260127"

  # Skyforge deploys Containerlab topologies to Kubernetes via Clabernetes.
  # This must be enabled for E2E deploy tests and user deployments to reconcile.
  clabernetes:
    enabled: true
    # Includes Skyforge per-topology scheduling enforcement based on Topology label
    # `skyforge.forwardnetworks.com/scheduling=spread-{required,preferred}`.
    managerImage: "ghcr.io/forwardnetworks/skyforge-clabernetes-manager:20260212-c9s-startup-partial"
    launcherImage: "ghcr.io/forwardnetworks/skyforge-clabernetes-launcher:20260212-c9s-startup-partial"

  # Current LDAP endpoint in this environment requires skipping TLS verification
  # for MinIO LDAP hook success. Set to false once LDAP cert trust is fixed.
  ldap:
    skipTlsVerify: true

images:
  # Pin images in prod so upgrades are repeatable (avoid implicit "latest").
  # NOTE: Keep these tags in sync with images that actually exist in GHCR.
  skyforgeServer: "ghcr.io/forwardnetworks/skyforge-server:20260215-cluster-hardening2"
  skyforgeServerWorker: "ghcr.io/forwardnetworks/skyforge-server:20260215-cluster-hardening2-worker"

kubernetes:
  # Ensure private GHCR images can be pulled in the release namespace.
  imagePullSecrets: ["ghcr-pull"]
