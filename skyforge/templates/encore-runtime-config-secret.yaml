{{- if .Values.skyforge.encoreRuntimeConfig.create }}
{{- $runtimeCfg := (default "{}" .Values.skyforge.encoreRuntimeConfig.json) | trim -}}
{{- if or (eq $runtimeCfg "") (eq $runtimeCfg "{}") -}}
{{- $runtimeCfg = (.Files.Get "files/infra.config.json" | trim) -}}
{{- end -}}
apiVersion: v1
kind: Secret
metadata:
  name: skyforge-encore-runtime-config
type: Opaque
stringData:
  # NOTE: Encore expects ENCORE_RUNTIME_CONFIG to be base64-encoded JSON.
  # This is infrastructure/runtime config, not typed config loaded via config.Load.
  # Keep it non-secret: do not include passwords/tokens here.
  skyforge-encore-runtime-config: {{ $runtimeCfg | b64enc | quote }}
{{- end }}
