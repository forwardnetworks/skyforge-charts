# Skyforge Helm values.
# Override anything here with your local deployment details.

skyforge:
  # Optional: run a standalone Atlas migration Job as a Helm hook.
  #
  # This is normally unnecessary because `skyforge-server` already runs migrations
  # in an initContainer before starting the API. Keeping this disabled avoids
  # hook-related upgrade failures when the cluster is temporarily unhealthy.
  migrateJob:
    enabled: false

  # Resources for the singleton worker Deployment.
  workerResources:
    requests:
      cpu: "250m"
      memory: "1Gi"
    limits: {}

  # Optional: provide ENCORE_RUNTIME_CONFIG for Encore runtime infrastructure config.
  # NOTE: This is NOT the same as typed Encore config loaded via config.Load.
  encoreRuntimeConfig:
    create: false
    json: "{}"
    workerCreate: false
    workerJson: "{}"

  # Optional: provide ENCORE_CFG_SKYFORGE for typed Encore config (config.Load).
  # The value must be a JSON object; the chart will base64url-encode it.
  # Keep it non-secret: do not include passwords/tokens here.
  encoreCfg:
    create: true
    json: "{}"
    workerJson: "{}"
  hostname: "skyforge.local.forwardnetworks.com"
  domain: "forwardnetworks.com"
  gateway:
    # Optional explicit Gateway addresses.
    # Set this in production to avoid Gateway "AddressNotAssigned" status when
    # using Cilium Gateway API with node-IP ingress.
    # Example:
    # addresses:
    #   - type: IPAddress
    #     value: "10.128.16.60"
    addresses: []
  # Skyforge uses Cilium Gateway API for ingress (no Traefik).
  # Optional cookie Domain attribute. Leave empty for host-only cookies.
  # If you enable any Skyforge tools on a subdomain (e.g. Hoppscotch at
  # `tool.<skyforge.hostname>`), set this to a common parent domain like
  # `.forwardnetworks.com` so SSO cookies work across subdomains.
  cookieDomain: ""
  adminUsers: "skyforge"
  awsSsoRegion: "us-east-1"
  awsSsoStartUrl: ""
  gitea:
    enabled: true
    apiUrl: ""
    url: ""
    username: "skyforge"
    repoPrivate: true
    adminUsername: "skyforge"
    allowedDomains: ""
  registry:
    # Container image registry used by the Designer palette.
    # Example: https://ghcr.io
    url: ""
    # Optional comma-separated prefixes to include (e.g. "forwardnetworks,lab").
    repoPrefixes: ""
    skipTlsVerify: false
    # Optional registry credentials (Kubernetes Secret name/key).
    usernameSecretName: "skyforge-registry-username"
    usernameSecretKey: "skyforge-registry-username"
    passwordSecretName: "skyforge-registry-password"
    passwordSecretKey: "skyforge-registry-password"
  netboxSsoUrl: ""
  nautobotSsoUrl: ""
  # Public base URL for Skyforge (used for webhook and SNMP instructions).
  publicUrl: ""
  ldap:
    displayAttr: "cn"
    groupAttr: "memberOf"
    mailAttr: "mail"
    skipTlsVerify: false
    startTls: false
    baseDn: ""
  oidc:
    discoveryUrl: "http://dex:5556/dex"
  listenAddr: ":8085"
  maxGroups: 50
  ssoSkipTlsVerify: false
  netbox:
    enabled: false
    # Redis database index for NetBox (shared Redis service).
    # Keep distinct from Skyforge (0) and Nautobot (1).
    redisDatabase: 2
  netboxUrl: ""
  netboxMgmtSubnet: "10.255.0.0/24"
  nautobot:
    enabled: false
    # Redis database index for Nautobot (shared Redis service).
    # Keep distinct from Skyforge (0) and NetBox (2).
    redisDatabase: 1
    bootstrap:
      # Nautobot bootstrap is a one-time operation. Leaving this enabled causes Helm
      # upgrades with `--wait` to hang/fail if the bootstrap job ever fails (and it is
      # not required for steady-state operation).
      enabled: false
  nautobotUrl: ""
  yaadeUrl: "http://yaade"
  yaadeAdminUsername: "admin"
  yaade:
    enabled: true
  gemini:
    enabled: false
    # Google OAuth client ID for per-user "Connect Gemini".
    clientID: ""
    # Optional override (default is derived from skyforge.publicUrl/hostname):
    #   https://<skyforge.hostname>/api/user/integrations/gemini/callback
    redirectURL: ""
    # Vertex AI settings used by the AI template generator.
    # These are not required for OAuth connect/disconnect, but are required to
    # actually call Gemini to generate templates.
    projectId: ""
    location: "us-central1"
    # Primary and fallback model IDs passed to the Vertex AI publisher endpoint.
    # We default to Gemini 3.0, with a pro -> flash fallback.
    model: "gemini-3.0-pro"
    fallbackModel: "gemini-3.0-flash"
    # Kubernetes Secret (name/key) containing the OAuth client secret.
    clientSecretSecretName: "skyforge-gemini-oauth-client-secret"
    clientSecretSecretKey: "skyforge-gemini-oauth-client-secret"
  ai:
    enabled: false

  # Optional Kubernetes admission policies that harden the cluster against
  # accidental non-native clabernetes deployments (Docker-in-Docker / docker.sock).
  #
  # Requires Kubernetes v1.30+ (ValidatingAdmissionPolicy).
  admissionPolicies:
    enabled: false
    # Namespace selector for enforcement (only namespaces matching this label are checked).
    namespaceSelectorLabel: "skyforge-managed"
    namespaceSelectorValue: "true"
    # Require Topology.spec.deployment.nativeMode == true (deny CREATE/UPDATE otherwise).
    requireClabernetesNativeMode: true
    # Deny Pods that mount /var/run/docker.sock via hostPath.
    forbidDockerSock: true
  staticRoot: "/opt/skyforge/static"
  objectStorage:
    endpoint: "s3gw:7480"
    useSsl: false
    filesBucket: "skyforge-files"
    # Kubernetes Secret (name/key) that holds the object storage access key used by
    # Skyforge artifact storage.
    #
    # Defaults match the existing secret names; you can rename the underlying
    # Secrets (for example, dropping "-terraform") by overriding these values.
    #
    accessKeySecretName: "object-storage-root-user"
    accessKeySecretKey: "object-storage-root-user"
    secretKeySecretName: "object-storage-root-password"
    secretKeySecretKey: "object-storage-root-password"
  terraform:
    path: ""
    version: ""
    url: ""
  netlab:
    sshUser: "ubuntu"
    stateRoot: "/var/lib/skyforge/netlab"
  netlabC9s:
    # Netlab (cluster-native) uses an in-cluster generator Job to run `netlab create`
    # and emit clabernetes-ready artifacts (ConfigMaps + manifest).
    # NOTE: Override this with a pinned tag in your deploy values for reproducibility.
    generatorImage: "ghcr.io/forwardnetworks/skyforge-netlab-generator:latest"
    generatorPullPolicy: "IfNotPresent"
    applierImage: "ghcr.io/forwardnetworks/skyforge-netlab-applier:latest"
    applierPullPolicy: "IfNotPresent"
  dns:
    enabled: false
    adminUsername: "admin"
    userZoneSuffix: "skyforge"
    # NodePort for UDP/TCP 53 on the k3s host.
    nodePort: 30053
    # NodePort for the DNS web UI on the k3s host.
    webNodePort: 30380
  userDataDir: "/var/lib/skyforge"
  userDeleteMode: "live"
  uiThemeDefault: ""
  # Typed config equivalent of SKYFORGE_NOTIFICATIONS_ENABLED. Default true.
  notificationsEnabled: true
  forward:
    # Enable Forward Networks integration (collector deployment + sync actions).
    # When false, Skyforge hides Forward UI and disables Forward API endpoints.
    enabled: true
    snmpPlaceholderEnabled: true
    snmpCommunity: "public"
  forwardCollector:
    # Optional: enable the in-cluster Forward collector by configuring the image.
    # When empty, Skyforge will not deploy a collector Pod (Collector page will
    # show "not configured").
    # Example:
    # image: "harbor.local.forwardnetworks.com/forward/fwd_collector:26.1.0-05"
    image: ""
    pullPolicy: "IfNotPresent"
    heapSizeGB: 0
    # Optional: registry pull secret to use for the collector image. When empty,
    # Skyforge falls back to the global Kubernetes imagePullSecret.
    imagePullSecretName: ""
    imagePullSecretNamespace: ""
  sessionTtl: "8h"
  pkiDefaultDays: 365
  sshDefaultDays: 30
  cookieSecure: true
  swaggerUrl: ""
  health:
    httpChecks: "Edge|edge|http://skyforge-server Server|server|http://skyforge-server Testing|api|http://yaade/api-testing/|/api-testing/;Swagger UI|swagger|http://swagger-ui:8080/|/swagger/;Webhook Inbox|webhooks|http://skyforge-server"
    codeChecks: "Postgres|postgres|pg|db;Redis|redis|redis|redis;RADIUS|radius|radius|freeradius"
  admin:
    username: "skyforge"
    name: "Skyforge"
  provisioner:
    login: "skyforge-provisioner"
    name: "Skyforge Provisioner"
  ui:
    productName: "Skyforge"
    productSubtitle: "Automation Hub"
    logoUrl: "/assets/skyforge/FN-logo.svg"
    logoAlt: "Skyforge"
    headerBgUrl: "/assets/skyforge/header-background.png"
    supportText: "Need access? Contact your platform admin."
    supportUrl: ""
  s3gw:
    enabled: true
    serviceName: "s3gw"
    service:
      port: 7480
    persistence:
      enabled: true
      size: "5Gi"
  db:
    host: "db"
    port: "5432"
    name: "skyforge_server"
    user: "skyforge_server"
    sslmode: "disable"
    # Forward services can open many idle JDBC sessions; keep headroom so
    # platform integrations (Dex/NetBox/Nautobot/Coder) are not starved.
    maxConnections: 300
  sessionCookie: "skyforge_session"
  syslog:
    enabled: false
    # Syslog events are collected via Vector (DaemonSet, hostNetwork).
    # Host port to bind on each node (UDP); defaults to 514.
    hostPort: 514
  snmpTraps:
    enabled: false
    # SNMP trap events are collected via Telegraf (DaemonSet, hostNetwork).
    # Host port to bind on each node (UDP); defaults to 162.
    hostPort: 162
  nodeMetrics:
    enabled: false
    interval: "10s"
  coder:
    enabled: true
    # Enables password auth for the bootstrap admin user (useful for demos).
    # Keep this true for strict SSO-only deployments.
    disablePasswordAuth: true
    oidcAutoLogin: true
    # Portal link (/coder) redirect target.
    # Default uses Coder's standard landing path.
    # For demo "open VS Code", set this to something like:
    #   /accounts/@skyforge-demo/skyforge-demo/apps/code-server
    portalRedirectPath: "/coder/launch"
    # Optional bootstrap admin user (created once, idempotent).
    # If you leave these empty, you'll need to create the first user manually.
    bootstrap:
      username: ""
      email: ""
      passwordSecretName: "coder-admin-bootstrap"
      passwordSecretKey: "password"
    demo:
      enabled: false
  dex:
    enabled: true
    # When false, Dex config is expected to be provided via the `dex-config` Secret
    # (for example, via deploy/skyforge-secrets.yaml). When true, the chart
    # generates and manages `dex-config` based on the values below.
    manageConfig: true
    # Optional: tweak Dex login page UX/branding. These settings are applied by an initContainer
    # that patches the Dex config from the `dex-config` Secret at startup.
    webTheme: ""
    logoUrl: "/assets/skyforge/FN-logo.svg"
    # Auth mode for Skyforge (via Dex). Supported:
    # - local: Dex static password DB (OSS default; password sourced from skyforge-admin-shared.password)
    # - google: Google Project / Cloud Identity login
    # - oidc: Generic OIDC connector (for providers such as Okta)
    # - ldap: LDAP login
    # - mock: mock callback connector (dev/test only)
    authMode: "local"
    local:
      # Dex login identity for local-password mode.
      username: "skyforge"
      email: "skyforge@skyforge.local.forwardnetworks.com"
      userID: "skyforge"
      # Optional: provide a precomputed bcrypt hash for Dex staticPasswords.
      # When empty, the chart derives a bcrypt hash from skyforge-admin-shared.password.
      passwordHash: ""
    google:
      # Google OAuth client ID for Dex.
      # Redirect URI to configure in Google Cloud:
      #   https://<skyforge.hostname>/dex/callback
      clientID: ""
      # Optional restriction to specific Google Project domains.
      hostedDomains:
        - "forwardnetworks.com"
      # Where to read the Google OAuth client secret from.
      clientSecretSecretName: "dex-google-client-secret"
      clientSecretSecretKey: "dex-google-client-secret"
    oidc:
      # Generic OIDC connector (for example, Okta).
      # Redirect URI to configure at the IdP:
      #   https://<skyforge.hostname>/dex/callback
      issuer: ""
      clientID: ""
      clientSecretSecretName: "dex-oidc-client-secret"
      clientSecretSecretKey: "dex-oidc-client-secret"
      # Optional override; defaults to https://<skyforge.hostname>/dex/callback
      redirectURI: ""
      # Optional provider-specific scopes.
      scopes:
        - openid
        - profile
        - email
        - groups
    # LDAP connector settings (used only when authMode=ldap).
    # NOTE: This is intentionally unconfigured by default.
    ldap:
      host: ""
      startTLS: false
      insecureSkipVerify: false
      bindDN: ""
      bindPW: ""
      usernamePrompt: "LDAP Username"
      userSearch:
        baseDN: ""
        filter: "(objectClass=person)"
        username: "uid"
        idAttr: "uid"
        emailAttr: "mail"
        nameAttr: "cn"

  swaggerUI:
    enabled: true
  clabernetes:
    # Experimental: deploy containerlab topologies to k8s via clabernetes.
    enabled: false
    # NOTE: Skyforge relies on a small set of patches for vrnetlab native-mode support.
    # Override these in your `deploy/skyforge-values*.yaml` if you pin images by tag.
    managerImage: "ghcr.io/forwardnetworks/skyforge-clabernetes-manager:latest"
    launcherImage: "ghcr.io/forwardnetworks/skyforge-clabernetes-launcher:latest"
    # Clabernetes connectivity default.
    #
    # Skyforge uses clabernetes' built-in VXLAN connectivity manager for cross-node L2
    # adjacency (LLDP, CDP, etc) without requiring additional CNIs.
    connectivity: "vxlan"

  # Optional: Cloudflare Tunnel (cloudflared) to expose Skyforge externally without opening inbound ports.
  # Requires you to create the tunnel in Cloudflare and store either a tunnel token or credentials.json in a Secret.
  cloudflareTunnel:
    enabled: false
    # Mode:
    # - token: use a token Secret from Cloudflare Zero Trust (recommended for stable hostnames)
    # - credentials: use credentials.json + tunnelId (stable hostnames, explicit ingress config)
    # - quick: unauthenticated trycloudflare.com URL (dynamic, changes on restart)
    mode: "token"
    # For quick tunnel mode, set the HTTP Host header sent to the Ingress controller.
    # Defaults to skyforge.hostname.
    httpHostHeader: ""
    # External hostname to publish (defaults to skyforge.hostname).
    hostname: ""
    # Internal service URL to proxy to (Ingress handles routing by Host header).
    # When empty, the chart defaults to the Cilium gateway service in the release namespace.
    service: ""
    # Optional extra hostnames to publish.
    additionalHostnames: []
    # Metrics/health endpoint (used for readiness/liveness probes).
    metrics: "0.0.0.0:2000"
    # Token mode (recommended easiest path): create a Secret with key "token".
    tokenSecretName: ""
    tokenSecretKey: "token"

    # Credentials mode: create a Secret containing credentials.json + set tunnelId.
    tunnelId: ""
    credentialsSecretName: ""
    credentialsSecretKey: "credentials.json"

images:
  # Use non-DockerHub registries for common base images to avoid Docker Hub pull rate limits.
  alpine: "public.ecr.aws/docker/library/alpine:3.20"
  # Used by internal CronJobs to call Skyforge worker endpoints (no runtime apk installs).
  # Note: use GHCR mirror to avoid Docker Hub pull rate limits in k3s/containerd.
  curl: "ghcr.io/forwardnetworks/skyforge-curl:8.6.0-1"
  envoy: "envoyproxy/envoy:v1.31.2"
  python: "ghcr.io/forwardnetworks/skyforge-python:3.12-alpine"
  # Vector publishes official images under `timberio/vector` (Docker Hub).
  # NOTE: If Docker Hub rate limits are a concern, mirror this image into your registry.
  vector: "timberio/vector:0.44.0-debian"
  telegraf: "ghcr.io/forwardnetworks/skyforge-telegraf:1.33-alpine"
  freeradius: "ghcr.io/freeradius/freeradius-server:3.2.5"
  # Prefer GHCR (Docker Hub rate limits are painful in-cluster).
  gitea: "ghcr.io/go-gitea/gitea:1.24.6-rootless"
  coder: "ghcr.io/coder/coder:latest"
  yaade: "ghcr.io/esperotech/yaade:latest"
  dex: "ghcr.io/dexidp/dex:v2.37.0"
  s3gw: "quay.io/s3gw/s3gw:latest"
  postgres: "public.ecr.aws/docker/library/postgres:15-alpine"
  redis: "public.ecr.aws/docker/library/redis:7-alpine"
  swaggerUi: "swaggerapi/swagger-ui:v5.11.0"
  technitiumDns: "docker.io/technitium/dns-server@sha256:94f2b90d63f03181421152157a8099ea2752b13fa30b6c96833859be8e93dfa9"
  # Mirror Atlas on GHCR to avoid Docker Hub rate limits in-cluster.
  atlas: "ghcr.io/forwardnetworks/skyforge-atlas:20260120-1139e29a"
  skyforgeNautobot: "ghcr.io/forwardnetworks/skyforge-nautobot:20260127-1253-277c9dc4"
  skyforgeNetbox: "ghcr.io/forwardnetworks/skyforge-netbox:4.5.0"
  skyforgeServer: "ghcr.io/forwardnetworks/skyforge-server:latest"
  # Optional dedicated task worker image (build-tagged to include the PubSub subscription).
  # Defaults to the same image as skyforgeServer for local/dev workflows.
  skyforgeServerWorker: "ghcr.io/forwardnetworks/skyforge-server:latest"
  nsq: "ghcr.io/forwardnetworks/skyforge-nsqd:v1.2.1"
  cloudflared: "cloudflare/cloudflared:2025.1.0"

nsq:
  enabled: true

kubernetes:
  # Optional image pull secrets to attach to service accounts created by the chart.
  # Example: ["ghcr-pull"] for private GHCR images.
  imagePullSecrets: []
  imagePullSecret:
    # Optional: create a pull secret in the release namespace.
    # Useful for OSS-style installs where you want a single script to set up
    # everything. Prefer supplying this via `--set-file` to avoid shell quoting.
    create: false
    name: "ghcr-pull"
    # Raw docker config JSON (contents of ~/.docker/config.json), NOT base64.
    dockerConfigJson: ""

secrets:
  # OSS baseline: keep runtime secrets out of Helm release values/history.
  # Set to true only for local/dev bootstrap workflows that intentionally pass
  # secret literals via a local, untracked values file.
  create: false
  # Optional runtime guard: when true and `create=false`, Helm install/upgrade
  # fails if required Secrets are missing from the release namespace.
  validatePrecreated: false
  items:
    skyforge-session-secret:
      skyforge-session-secret: ""
    skyforge-admin-shared:
      password: ""
    skyforge-ldap-url:
      skyforge-ldap-url: ""
    skyforge-ldap-bind-template:
      skyforge-ldap-bind-template: ""
    skyforge-ldap-lookup-binddn:
      skyforge-ldap-lookup-binddn: ""
    skyforge-ldap-lookup-bindpassword:
      skyforge-ldap-lookup-bindpassword: ""
    skyforge-internal-token:
      skyforge-internal-token: ""
    skyforge-containerlab-jwt-secret:
      skyforge-containerlab-jwt-secret: ""
    skyforge-pki-ca-cert:
      skyforge-pki-ca-cert: ""
    skyforge-pki-ca-key:
      skyforge-pki-ca-key: ""
    skyforge-ssh-ca-key:
      skyforge-ssh-ca-key: ""
    skyforge-netlab-servers:
      # JSON array of netlab server configs. Example:
      # [{"name":"netlab","apiUrl":"https://netlab.local.forwardnetworks.com/netlab","apiInsecure":false,"apiToken":"<bearer>"}]
      skyforge-netlab-servers: "[]"
    netlab-runner-rsa:
      netlab-runner-rsa: ""
    postgres-skyforge-password:
      postgres-skyforge-password: ""
    db-netbox-password:
      db-netbox-password: ""
    db-nautobot-password:
      db-nautobot-password: ""
    db-gitea-password:
      db-gitea-password: ""
    db-coder-password:
      db-coder-password: ""
    db-dex-password:
      db-dex-password: ""
    db-skyforge-server-password:
      db-skyforge-server-password: ""
    dex-client-coder-secret:
      dex-client-coder-secret: ""
    dex-google-client-secret:
      dex-google-client-secret: ""
    dex-oidc-client-secret:
      dex-oidc-client-secret: ""
    skyforge-oidc-discovery-url:
      skyforge-oidc-discovery-url: ""
    skyforge-oidc-client-id:
      skyforge-oidc-client-id: ""
    skyforge-oidc-client-secret:
      skyforge-oidc-client-secret: ""
    skyforge-gemini-oauth-client-secret:
      skyforge-gemini-oauth-client-secret: ""
    yaade-admin-password:
      yaade-admin-password: ""
    gitea-secret-key:
      gitea-secret-key: ""
    coder-admin-bootstrap:
      password: ""
    gitea-ldap-binddn:
      gitea-ldap-binddn: ""
    gitea-ldap-bindpassword:
      gitea-ldap-bindpassword: ""
    object-storage-root-user:
      object-storage-root-user: ""
    object-storage-root-password:
      object-storage-root-password: ""
    object-storage-access-key:
      object-storage-access-key: ""
    object-storage-secret-key:
      object-storage-secret-key: ""
    netbox-superuser-api-token:
      netbox-superuser-api-token: ""
    netbox-api-token-peppers:
      netbox-api-token-peppers: ""
    netbox-secret-key:
      netbox-secret-key: ""
    nautobot-superuser-api-token:
      nautobot-superuser-api-token: ""
    nautobot-secret-key:
      nautobot-secret-key: ""
    object-storage-artifacts-access-key:
      object-storage-artifacts-access-key: ""
    object-storage-artifacts-secret-key:
      object-storage-artifacts-secret-key: ""
    aws-terraform-shared-credentials:
      aws-terraform-shared-credentials: ""
    proxy-tls:
      tls.crt: ""
      tls.key: ""
      _type: "kubernetes.io/tls"
    skyforge-ca-cert:
      skyforge-ca-cert: ""
