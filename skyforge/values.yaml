# Skyforge Helm values.
# Override anything here with your local deployment details.

skyforge:
  serverReplicaCount: 1
  portalReplicaCount: 1
  # When false, skyforge-server pods NACK queue messages; use workerReplicaCount>0 to drain the queue.
  taskWorkerEnabled: true
  # Optional dedicated worker deployment replica count. When > 0, the chart
  # creates a separate Deployment that runs the task worker.
  workerReplicaCount: 0
  hostname: "skyforge.lab.local"
  domain: "lab.local"
  # Optional cookie Domain attribute. Leave empty for host-only cookies.
  # If you enable any Skyforge tools on a subdomain (e.g. Hoppscotch at
  # `tool.<skyforge.hostname>`), set this to a common parent domain like
  # `.skyforge.lab.local` so SSO cookies work across subdomains.
  cookieDomain: ""
  adminUsers: "skyforge"
  awsSsoRegion: "us-east-1"
  awsSsoStartUrl: ""
  gitea:
    apiUrl: ""
    url: ""
    username: "skyforge"
    repoPrivate: true
    adminUsername: "skyforge"
    allowedDomains: ""
  netboxSsoUrl: ""
  nautobotSsoUrl: ""
  eveApiUrl: ""
  eveUsername: ""
  eveSkipTlsVerify: false
  eveUrl: ""
  eveSshUser: "root"
  eveSshTunnelEnabled: true
  labpp:
    runnerImage: ""
    runnerPullPolicy: "IfNotPresent"
    runnerPvc: "skyforge-server-data"
    configDirBase: "/var/lib/skyforge/labpp/configs"
    configVersion: "1.0"
    netboxUrl: ""
    netboxMgmtSubnet: ""
    s3Region: ""
    s3Bucket: ""
    s3Endpoint: ""
    s3DisableSsl: true
    s3DisableChecksum: false
  # Optional (legacy): expose an external LabPP API through Traefik.
  # Not required when using the bundled LabPP CLI runner.
  labppProxy:
    enabled: false
    port: 443
    serversTransport: "eve-servers-transport"
    servers: []
  # Optional: expose EVE-NG UI through Traefik on the Skyforge hostname.
  # When enabled, this creates Services/Endpoints that point at external EVE hosts and routes:
  #   https://<skyforge-hostname>/labs/<name>/*  ->  https://<eve-ip>:443/*
  eveProxy:
    enabled: false
    port: 443
    serversTransport: "eve-servers-transport"
    servers: []
  ldap:
    displayAttr: "cn"
    groupAttr: "memberOf"
    mailAttr: "mail"
    skipTlsVerify: false
    startTls: false
    baseDn: ""
  listenAddr: ":8085"
  maxGroups: 50
  platformDataDir: "/data"
  ssoSkipTlsVerify: false
  netboxUrl: ""
  netboxMgmtSubnet: "10.255.0.0/24"
  nautobotUrl: ""
  yaadeUrl: "http://yaade"
  yaadeAdminUsername: "admin"
  objectStorage:
    endpoint: "minio:9000"
    useSsl: false
  netlab:
    sshUser: "ubuntu"
    stateRoot: "/var/lib/skyforge/netlab"
  dns:
    enabled: false
    # NodePort for UDP/TCP 53 on the k3s host.
    nodePort: 30053
    # NodePort for the DNS web UI on the k3s host.
    webNodePort: 30380
  workspacesDataDir: "/var/lib/skyforge"
  workspaceSyncSeconds: 300
  uiThemeDefault: ""
  sessionTtl: "8h"
  pkiDefaultDays: 365
  sshDefaultDays: 30
  cookieSecure: true
  stateBackend: "postgres"
  swaggerUrl: ""
  db:
    host: "db"
    port: 5432
    name: "skyforge_server"
    user: "skyforge_server"
    sslmode: "disable"
  health:
    httpChecks: "Edge|edge|http://skyforge-portal:3000/|/;Skyforge Server|server|http://skyforge-server:8085/api/health|/skyforge-server/health;EVE-NG|ðŸ§ª|http://skyforge-server:8085/api/health/eve|/labs/;NetBox|netbox|http://netbox:8080/netbox/login/|/netbox/;Nautobot|nautobot|http://nautobot:8080/nautobot/login/|/nautobot/;Git|git|http://gitea:3000/|/git/;Coder|coder|http://coder:7080/healthz|/coder/;API Testing|api|http://yaade/api-testing/|/api-testing/;Swagger UI|swagger|http://swagger-ui:8080/|/swagger/;Webhook Inbox|webhooks|http://skyforge-portal:3000/webhooks|/webhooks/"
    codeChecks: "Postgres|postgres|pg|db;Redis|redis|redis|redis;RADIUS|radius|radius|freeradius"
  admin:
    username: "skyforge"
    name: "Skyforge"
  provisioner:
    login: "skyforge-provisioner"
    name: "Skyforge Provisioner"
  ui:
    productName: "Skyforge"
    productSubtitle: "Automation Hub"
    logoUrl: "/assets/skyforge/FN-logo.svg"
    logoAlt: "Skyforge"
    headerBgUrl: "/assets/skyforge/header-background.png"
    supportText: "Need access? Contact your platform admin."
    supportUrl: ""
  minio:
    consoleSubpath: "/minio-console"
    # Optional: LDAP group to grant MinIO Console access + read/write bucket access.
    # If empty, LDAP users may be able to authenticate but lack permissions.
    ldapConsoleGroup: ""
  sessionCookie: "skyforge_session"
  syslog:
    enabled: false
    # Syslog events are collected via Vector (DaemonSet, hostNetwork).
    # Host port to bind on each node (UDP); defaults to 514.
    hostPort: 514
  snmpTraps:
    enabled: false
    # SNMP trap events are collected via Telegraf (DaemonSet, hostNetwork).
    # Host port to bind on each node (UDP); defaults to 162.
    hostPort: 162
  nodeMetrics:
    enabled: false
    interval: "10s"
  coder:
    # Enables password auth for the bootstrap admin user (useful for demos).
    # Keep this true for strict SSO-only deployments.
    disablePasswordAuth: true
    oidcAutoLogin: true
    # Portal link (/coder) redirect target.
    # Default goes to Coder's workspace UI under /workspaces.
    # For demo "open VS Code", set this to something like:
    #   /workspaces/@skyforge-demo/skyforge-demo/apps/code-server
    portalRedirectPath: "/coder/launch"
    # Optional bootstrap admin user (created once, idempotent).
    # If you leave these empty, you'll need to create the first user manually.
    bootstrap:
      username: ""
      email: ""
      passwordSecretName: "coder-admin-bootstrap"
      passwordSecretKey: "password"
    demo:
      enabled: false
  clabernetes:
    # Experimental: deploy containerlab topologies to k8s via clabernetes.
    enabled: false
    managerImage: "ghcr.io/srl-labs/clabernetes/clabernetes-manager:dev-latest"
    launcherImage: "ghcr.io/srl-labs/clabernetes/clabernetes-launcher:dev-latest"
    replicaCount: 1

  # Optional: Cloudflare Tunnel (cloudflared) to expose Skyforge externally without opening inbound ports.
  # Requires you to create the tunnel in Cloudflare and store either a tunnel token or credentials.json in a Secret.
  cloudflareTunnel:
    enabled: false
    # Mode:
    # - token: use a token Secret from Cloudflare Zero Trust (recommended for stable hostnames)
    # - credentials: use credentials.json + tunnelId (stable hostnames, explicit ingress config)
    # - quick: unauthenticated trycloudflare.com URL (dynamic, changes on restart)
    mode: "token"
    # For quick tunnel mode, set the HTTP Host header sent to Traefik.
    # Defaults to skyforge.hostname.
    httpHostHeader: ""
    # External hostname to publish (defaults to skyforge.hostname).
    hostname: ""
    # Internal service URL to proxy to (Traefik handles routing by Host header).
    # NOTE: Skyforge's Traefik routes typically live on the HTTPS entrypoint.
    # Use the HTTPS Traefik service by default.
    service: "https://traefik.kube-system.svc.cluster.local:443"
    # Optional extra hostnames to publish.
    additionalHostnames: []
    # Metrics/health endpoint (used for readiness/liveness probes).
    metrics: "0.0.0.0:2000"
    replicaCount: 1

    # Token mode (recommended easiest path): create a Secret with key "token".
    tokenSecretName: ""
    tokenSecretKey: "token"

    # Credentials mode: create a Secret containing credentials.json + set tunnelId.
    tunnelId: ""
    credentialsSecretName: ""
    credentialsSecretKey: "credentials.json"

images:
  alpine: "alpine:3.20"
  vector: "timberio/vector:0.44.0-debian"
  telegraf: "telegraf:1.33-alpine"
  freeradius: "freeradius/freeradius-server:3.2.5"
  gitea: "gitea/gitea:1.22.3-rootless"
  coder: "ghcr.io/coder/coder:latest"
  yaade: "esperotech/yaade:latest"
  dex: "ghcr.io/dexidp/dex:v2.37.0"
  minio: "minio/minio:RELEASE.2024-11-07T00-52-20Z"
  minioMc: "minio/mc:RELEASE.2024-11-17T19-35-25Z"
  minioMcRelease: "minio/mc:RELEASE.2024-11-17T19-35-25Z"
  postgres: "postgres:15-alpine"
  redis: "redis:7-alpine"
  swaggerUi: "swaggerapi/swagger-ui:v5.11.0"
  technitiumDns: "docker.io/technitium/dns-server@sha256:94f2b90d63f03181421152157a8099ea2752b13fa30b6c96833859be8e93dfa9"
  atlas: "docker.io/arigaio/atlas@sha256:1139e29a47364e642cc2f4912fd2ff7c8b31a23886fdbf7bfdfdf50b39625190"
  skyforgeNautobot: "ghcr.io/forwardnetworks/skyforge-nautobot:20260108-0135"
  skyforgeNetbox: "ghcr.io/forwardnetworks/skyforge-netbox:4.5.0"
  skyforgePortal: "ghcr.io/forwardnetworks/skyforge-portal:20260112-2358"
  skyforgeServer: "ghcr.io/forwardnetworks/skyforge-server:20260114-0447-dd7991f"
  # Optional dedicated task worker image (build-tagged to include the PubSub subscription).
  # Defaults to the same image as skyforgeServer for local/dev workflows.
  skyforgeServerWorker: "ghcr.io/forwardnetworks/skyforge-server:20260114-0447-dd7991f-worker"
  nsq: "nsqio/nsq:v1.2.1"
  cloudflared: "cloudflare/cloudflared:2025.1.0"

nsq:
  enabled: true

kubernetes:
  # Optional image pull secrets to attach to service accounts created by the chart.
  # Example: ["ghcr-pull"] for private GHCR images.
  imagePullSecrets: []

secrets:
  create: true
  items:
    skyforge-session-secret:
      skyforge-session-secret: ""
    skyforge-admin-shared:
      password: ""
    skyforge-ldap-url:
      skyforge-ldap-url: ""
    skyforge-ldap-bind-template:
      skyforge-ldap-bind-template: ""
    skyforge-internal-token:
      skyforge-internal-token: ""
    skyforge-eve-password:
      skyforge-eve-password: ""
    skyforge-eve-servers:
      skyforge-eve-servers: "[]"
    skyforge-netlab-servers:
      skyforge-netlab-servers: "[]"
    netlab-runner-rsa:
      netlab-runner-rsa: ""
    eve-runner-ssh-key:
      eve-runner-ssh-key: ""
    postgres-skyforge-password:
      postgres-skyforge-password: ""
    db-netbox-password:
      db-netbox-password: ""
    db-nautobot-password:
      db-nautobot-password: ""
    db-gitea-password:
      db-gitea-password: ""
    db-dex-password:
      db-dex-password: ""
    db-skyforge-server-password:
      db-skyforge-server-password: ""
    dex-config:
      config.yaml: ""
    dex-client-coder-secret:
      dex-client-coder-secret: ""
    skyforge-oidc-discovery-url:
      skyforge-oidc-discovery-url: ""
    skyforge-oidc-client-id:
      skyforge-oidc-client-id: ""
    skyforge-oidc-client-secret:
      skyforge-oidc-client-secret: ""
    skyforge-labpp-netbox-token:
      skyforge-labpp-netbox-token: ""
    yaade-admin-password:
      yaade-admin-password: ""
    gitea-secret-key:
      gitea-secret-key: ""
    coder-admin-bootstrap:
      password: ""
    gitea-ldap-binddn:
      gitea-ldap-binddn: ""
    gitea-ldap-bindpassword:
      gitea-ldap-bindpassword: ""
    object-storage-root-user:
      object-storage-root-user: ""
    object-storage-root-password:
      object-storage-root-password: ""
    object-storage-terraform-access-key:
      object-storage-terraform-access-key: ""
    object-storage-terraform-secret-key:
      object-storage-terraform-secret-key: ""
    netbox-superuser-api-token:
      netbox-superuser-api-token: ""
    netbox-api-token-peppers:
      netbox-api-token-peppers: ""
    netbox-secret-key:
      netbox-secret-key: ""
    nautobot-superuser-api-token:
      nautobot-superuser-api-token: ""
    nautobot-secret-key:
      nautobot-secret-key: ""
    object-storage-artifacts-access-key:
      object-storage-artifacts-access-key: ""
    object-storage-artifacts-secret-key:
      object-storage-artifacts-secret-key: ""
    aws-terraform-shared-credentials:
      aws-terraform-shared-credentials: ""
    skyforge-pki-ca-cert:
      skyforge-pki-ca-cert: ""
    skyforge-pki-ca-key:
      skyforge-pki-ca-key: ""
    proxy-tls:
      tls.crt: ""
      tls.key: ""
      _type: "kubernetes.io/tls"
    skyforge-ca-cert:
      skyforge-ca-cert: ""
